import{useApi as e,defineInterface as t}from"@directus/extensions-sdk";import{defineComponent as a,inject as l,ref as n,computed as o,resolveComponent as i,openBlock as r,createElementBlock as s,createVNode as d,unref as c,withCtx as u,createTextVNode as f,toDisplayString as v,createBlock as p,createCommentVNode as m,Fragment as g}from"vue";import{useI18n as y}from"vue-i18n";const h={class:"pdf-to-html-interface"};var b=a({__name:"interface",props:{file_field:{},target_field:{},button_label:{default:"Convert PDF to HTML"}},setup(t){const a=t,{t:b}=y(),_=e(),x=l("values",n({})),T=n(!1),P=n(null),D=n(!1),{fileID:F,fileIsValid:w}=function(){const e=l("values",n({})),t=o((()=>{var t;return a.file_field&&null!=(t=e.value[a.file_field])?t:null})),i=o((()=>!!t.value));return{fileID:t,fileIsValid:i}}();async function L(){var e,t,l,n,o,i,r,s,d;if(F.value){T.value=!0,P.value=null,D.value=!1;try{let n;console.log("Converting PDF with file ID:",F.value);try{console.log("Trying /extensions/llama-pdf-extract path..."),n=await _.get(`/extensions/llama-pdf-extract/${F.value}`)}catch(t){if(404!==(null==(e=t.response)?void 0:e.status))throw t;console.log("Trying /llama-pdf-extract path..."),n=await _.get(`/llama-pdf-extract/${F.value}`)}if(console.log("API response:",n),!(null==(l=null==(t=n.data)?void 0:t.data)?void 0:l.html))throw console.error("Invalid response structure:",n),new Error("No HTML content received from conversion service");a.target_field&&x.value&&(x.value[a.target_field]=n.data.data.html,console.log(`Updated field ${a.target_field} with HTML content`));try{await navigator.clipboard.writeText(n.data.data.html),D.value=!0}catch(e){console.warn("Could not copy to clipboard:",e),D.value=!!a.target_field}}catch(e){console.error("Error converting PDF:",e),console.error("Error details:",{message:e.message,status:null==(n=e.response)?void 0:n.status,data:null==(o=e.response)?void 0:o.data,url:`/extensions/llama-pdf-extract/${F.value}`}),(null==(r=null==(i=e.response)?void 0:i.data)?void 0:r.message)?P.value=e.response.data.message:404===(null==(s=e.response)?void 0:s.status)?P.value="Please add a PDF file":400===(null==(d=e.response)?void 0:d.status)?P.value="Invalid PDF file. Please select a valid PDF file.":P.value="Failed to convert PDF. Please try again."}finally{T.value=!1,D.value&&setTimeout((()=>{D.value=!1}),3e3)}}}return o((()=>{const e=l("values",n({}));return!(!a.file_field||!e.value[a.file_field])})),(e,t)=>{const a=i("v-icon"),l=i("v-button"),n=i("v-notice");return r(),s("div",h,[d(l,{disabled:!c(w)||T.value,loading:T.value,onClick:L},{default:u((()=>[d(a,{name:"transform",left:""}),f(" "+v(c(w)?c(b)(e.button_label):"Please select a PDF file"),1)])),_:1},8,["disabled","loading"]),P.value?(r(),p(n,{key:0,type:"danger",class:"notice"},{default:u((()=>[f(v(P.value),1)])),_:1})):m("v-if",!0),D.value?(r(),p(n,{key:1,type:"success",class:"notice"},{default:u((()=>[e.target_field?(r(),s(g,{key:0},[f(" HTML content has been inserted into "+v(e.target_field)+" field ",1)],64)):(r(),s(g,{key:1},[f(" HTML content has been copied to clipboard ")],64))])),_:1})):m("v-if",!0)])}}}),_=[],x=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,l=!0===t.prepend?"prepend":"append",n=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(n){var i=_.indexOf(o);-1===i&&(i=_.push(o)-1,x[i]={}),a=x[i]&&x[i][l]?x[i][l]:x[i][l]=r()}else a=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),n=0;n<a.length;n++)e.setAttribute(a[n],t.attributes[a[n]]);var i="prepend"===l?"afterbegin":"beforeend";return o.insertAdjacentElement(i,e),e}}("\n.pdf-to-html-interface[data-v-ba7b52c8] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8px;\n}\n.notice[data-v-ba7b52c8] {\n\tmargin-top: 8px;\n}\n",{});var T=t({id:"pdf-to-html-interface",name:"PDF to HTML",icon:"transform",description:"Convert PDF files to formatted HTML",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,l]of t)a[e]=l;return a})(b,[["__scopeId","data-v-ba7b52c8"],["__file","interface.vue"]]),types:["alias"],localTypes:["presentation"],group:"presentation",options:({collection:e})=>[{field:"file_field",type:"string",name:"PDF Field",meta:{width:"half",interface:"system-field",options:{collectionName:e,typeAllowList:["uuid"]}}},{field:"target_field",type:"string",name:"Target HTML Field",meta:{width:"half",interface:"system-field",options:{collectionName:e,typeAllowList:["text","string"]}}},{field:"button_label",name:"Button Label",type:"string",meta:{width:"half",interface:"input",options:{placeholder:"Convert PDF to HTML"}},schema:{default_value:"Convert PDF to HTML"}}]});export{T as default};
